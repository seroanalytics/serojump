<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intro 2: Explanation of observational and antibody kinetics models • serojump</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Intro 2: Explanation of observational and antibody kinetics models">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">serojump</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_format.html">Intro 1: Data format for input files</a>
    </li>
    <li>
      <a href="../articles/model_define.html">Intro 2: Explanation of observational and antibody kinetics models</a>
    </li>
    <li>
      <a href="../articles/sim_recovery.html">Case Study 1: Simulation Recovery</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Intro 2: Explanation of observational and
antibody kinetics models</h1>
                        <h4 data-toc-skip class="author">David
Hodgson</h4>
            
            <h4 data-toc-skip class="date">2024-10-18</h4>
      

      <div class="hidden name"><code>model_define.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document explains two critical parts of the model defined in the
provided R code:</p>
<ol style="list-style-type: decimal">
<li>The <strong>Observational Model</strong>: This component models the
observed data, specifying how the measured values relate to the latent
(unobserved) processes.</li>
<li>The <strong>Antibody Kinetics Model</strong>: This component models
the changes in antibody levels over time, accounting for both natural
decay (waning) and infection-induced changes.</li>
</ol>
<hr>
</div>
<div class="section level2">
<h2 id="load-the-necessary-packages">0. Load the necessary packages<a class="anchor" aria-label="anchor" href="#load-the-necessary-packages"></a>
</h2>
<p>Install these if they are not already installed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">serojump</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-observational-model">1. The Observational Model<a class="anchor" aria-label="anchor" href="#the-observational-model"></a>
</h2>
<div class="section level3">
<h3 id="definition">Definition<a class="anchor" aria-label="anchor" href="#definition"></a>
</h3>
<p>The observational model captures the process by which observed data
(<code>IgG</code> in this case) is generated from the underlying system.
It defines the relationship between the true (latent) variables and the
observed data.</p>
</div>
<div class="section level3">
<h3 id="code-breakdown">Code Breakdown<a class="anchor" aria-label="anchor" href="#code-breakdown"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obsLogLikelihood</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">titre_val</span>, <span class="va">titre_est</span>, <span class="va">pars</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">titre_val</span>, <span class="va">titre_est</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">ll</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">observationalModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IgG"</span><span class="op">)</span>,</span>
<span>    model <span class="op">=</span> <span class="fu"><a href="../reference/makeModel.html">makeModel</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="../reference/addObservationalModel.html">addObservationalModel</a></span><span class="op">(</span><span class="st">"IgG"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma"</span><span class="op">)</span>, <span class="va">obsLogLikelihood</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="../reference/add_par_df.html">add_par_df</a></span><span class="op">(</span><span class="st">"sigma"</span>, <span class="fl">0.0001</span>, <span class="fl">4</span>, <span class="st">"unif"</span>, <span class="fl">0.0001</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="co"># observational model,</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li><p><strong><code>names = c("IgG")</code></strong>: The observed
biomarker here is <code>IgG</code>, representing some measurement, such
as a biomarker (e.g., antibody concentration).</p></li>
<li><p><strong><code>model = makeModel(...)</code></strong>: The model
is created using the <code>makeModel</code> function, which defines how
the observation model is constructed.</p></li>
<li><p><strong><code>addObservationalModel("IgG", c("sigma"), obsLogLikelihood)</code></strong>:
This line adds an observational model for <code>IgG</code>, where the
parameter <code>sigma</code> is used to model the noise or uncertainty
in the observations. The log-likelihood function
(<code>obsLogLikelihood</code>) is used to define how the observations
relate to the latent variable.</p></li>
<li><p><strong><code>prior = bind_rows(...)</code></strong>: This block
defines the prior distribution for the parameter <code>sigma</code>,
which controls the observation noise.</p></li>
<li><p><strong><code>add_par_df("sigma", 0.0001, 4, "unif", 0.0001, 4)</code></strong>:
The parameter <code>sigma</code> is given a uniform prior distribution
between <code>0.0001</code> and <code>4</code>, indicating that the
model expects a certain range of variability in the observed
data.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>The observational model defines how the <code>IgG</code> variable is
observed with some noise, controlled by <code>sigma</code>. The
log-likelihood function helps relate the true underlying values to the
observed values, while the prior on <code>sigma</code> assumes uniform
uncertainty.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-antibody-kinetics-model">2. The Antibody Kinetics Model<a class="anchor" aria-label="anchor" href="#the-antibody-kinetics-model"></a>
</h2>
<div class="section level3">
<h3 id="definition-1">Definition<a class="anchor" aria-label="anchor" href="#definition-1"></a>
</h3>
<p>The antibody kinetics model describes how antibody levels evolve over
time in response to different factors, such as infection or natural
waning. This model accounts for both natural decay in antibody levels
and changes due to infection.</p>
</div>
<div class="section level3">
<h3 id="code-breakdown-1">Code Breakdown<a class="anchor" aria-label="anchor" href="#code-breakdown-1"></a>
</h3>
<p>Define the antibody kinetic functions</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">noInfSerumKinetics</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">titre_est</span>, <span class="va">timeSince</span>, <span class="va">pars</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">titre_est_new</span> <span class="op">&lt;-</span> <span class="va">titre_est</span> <span class="op">-</span> <span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">titre_est</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">timeSince</span><span class="op">)</span></span>
<span>    <span class="va">titre_est_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">titre_est_new</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">titre_est_new</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">infTuenisPower2016</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">titre_est</span>, <span class="va">timeSince</span>, <span class="va">pars</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">v</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span>    <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">t1</span> <span class="op">*</span> <span class="va">y1</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">timeSince</span> <span class="op">&lt;</span> <span class="va">t1</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">titre_est_boost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">mu</span> <span class="op">*</span> <span class="va">timeSince</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">titre_est_boost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">r</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span><span class="op">^</span><span class="op">{</span><span class="va">r</span> <span class="op">-</span> <span class="fl">1</span><span class="op">}</span> <span class="op">*</span> <span class="va">v</span> <span class="op">*</span> <span class="op">(</span><span class="va">timeSince</span> <span class="op">-</span> <span class="va">t1</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="op">{</span><span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">r</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">titre_est_log</span> <span class="op">&lt;-</span> <span class="va">titre_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">titre_est_boost</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">titre_est</span> <span class="op">*</span> <span class="va">alpha</span><span class="op">)</span></span>
<span>    <span class="va">titre_est_log</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Create the antibody kinetics model</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abkineticsModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="fu"><a href="../reference/makeModel.html">makeModel</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="../reference/addAbkineticsModel.html">addAbkineticsModel</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"IgG"</span>, <span class="st">"none"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wane"</span><span class="op">)</span>, <span class="va">noInfSerumKinetics</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="../reference/addAbkineticsModel.html">addAbkineticsModel</a></span><span class="op">(</span><span class="st">"inf"</span>, <span class="st">"IgG"</span>, <span class="st">"inf"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y1_h1"</span>, <span class="st">"t1_h1"</span>, <span class="st">"r_h1"</span>, <span class="st">"s"</span><span class="op">)</span>, <span class="va">infTuenisPower2016</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="../reference/add_par_df.html">add_par_df</a></span><span class="op">(</span><span class="st">"y1_h1"</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="st">"unif"</span>,  <span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="../reference/add_par_df.html">add_par_df</a></span><span class="op">(</span><span class="st">"t1_h1"</span>, <span class="fl">3</span>, <span class="fl">14</span>, <span class="st">"unif"</span>, <span class="fl">3</span>, <span class="fl">14</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="../reference/add_par_df.html">add_par_df</a></span><span class="op">(</span><span class="st">"r_h1"</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="st">"unif"</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="../reference/add_par_df.html">add_par_df</a></span><span class="op">(</span><span class="st">"s"</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="st">"unif"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="../reference/add_par_df.html">add_par_df</a></span><span class="op">(</span><span class="st">"wane"</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="st">"unif"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li><p><strong><code>model = makeModel(...)</code></strong>: The
antibody kinetics model is built using <code>makeModel</code>, which
defines two different antibody response models.</p></li>
<li><p><strong><code>addAbkineticsModel("none", "PreF", "none", c("wane"), noInfSerumKinetics)</code></strong>:
This line models the antibody kinetics when there is <strong>no
infection</strong>. The “PreF” biomarker is modeled with the parameter
<code>wane</code>, which represents the natural decay or waning of
antibody levels over time. The <code>noInfSerumKinetics</code> function
describes this process.</p></li>
<li>
<p><strong><code>addAbkineticsModel("inf", "PreF", "inf", c("y1_h1", "t1_h1", "r_h1", "s"), infTuenisPower2016)</code></strong>:
This line models the antibody kinetics <strong>after infection</strong>.
Several parameters describe the response to infection:</p>
<ul>
<li>
<strong><code>y1_h1</code></strong>: Initial antibody level
post-infection.</li>
<li>
<strong><code>t1_h1</code></strong>: Time of peak response.</li>
<li>
<strong><code>r_h1</code></strong>: Rate of antibody decay
post-infection.</li>
<li>
<strong><code>s</code></strong>: Slope of decay after peak
response.</li>
<li>
<strong><code>infTuenisPower2016</code></strong>: The function
governing the infection-induced antibody response.</li>
</ul>
</li>
<li>
<p><strong><code>prior = bind_rows(...)</code></strong>: This block
defines prior distributions for the model parameters:</p>
<ul>
<li>
<strong><code>y1_h1</code></strong>: Uniform prior between
<code>1</code> and <code>6</code>, representing the initial antibody
level after infection.</li>
<li>
<strong><code>t1_h1</code></strong>: Normal prior with mean
<code>14</code> and standard deviation <code>3</code>, representing the
time to peak response.</li>
<li>
<strong><code>r_h1</code></strong>: Uniform prior between
<code>1</code> and <code>5</code>, representing the rate of antibody
decay.</li>
<li>
<strong><code>s</code></strong>: Uniform prior between
<code>0</code> and <code>1</code>, representing the slope of the decay
post-infection.</li>
<li>
<strong><code>wane</code></strong>: Uniform prior between
<code>0</code> and <code>1</code>, representing the natural waning of
antibody levels over time.</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="summary-1">Summary<a class="anchor" aria-label="anchor" href="#summary-1"></a>
</h3>
<p>The antibody kinetics model accounts for the natural waning of
antibodies in the absence of infection, as well as the antibody response
after infection. Parameters such as <code>y1_h1</code>,
<code>t1_h1</code>, and <code>r_h1</code> govern the kinetics of
antibody production and decay. The model uses both uniform and normal
priors to specify reasonable ranges for these parameters.</p>
</div>
</div>
<div class="section level2">
<h2 id="full-model-definition">3. Full model definition<a class="anchor" aria-label="anchor" href="#full-model-definition"></a>
</h2>
<p>This R code defines a serological model using different components
such as biomarkers, exposure types, observational and antibody kinetics
models, and priors. The code creates a model definitions
(<code>modeldefinition</code>) and uses these to create a serological
model for data analysis (<code>seroModel</code>).</p>
</div>
<div class="section level2">
<h2 id="step-by-step-breakdown">Step-by-Step Breakdown<a class="anchor" aria-label="anchor" href="#step-by-step-breakdown"></a>
</h2>
<div class="section level3">
<h3 id="step-1-define-the-first-model-modeldefinition">Step 1: Define the First Model <code>modeldefinition</code><a class="anchor" aria-label="anchor" href="#step-1-define-the-first-model-modeldefinition"></a>
</h3>
<p>Once all the data is loaded in, the first step is to define the
model. This includes the biomarkers, exposure types, exposure fitted,
observational model, and antibody kinetics model. Then, once the list is
created, the <code>createSeroJumpModel</code> function is used to create
the serojump model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># See data_format.Rmd vignette about data input types </span></span>
<span></span>
<span><span class="va">biomarkers</span> <span class="op">&lt;-</span> <span class="st">"IgG"</span></span>
<span></span>
<span><span class="co"># Create the data_sero dataframe</span></span>
<span><span class="va">data_sero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">50</span>, <span class="fl">1</span>, <span class="fl">50</span>, <span class="fl">1</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  IgG <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">4.4</span>, <span class="fl">1.2</span>, <span class="fl">4.4</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define possible exposure types</span></span>
<span><span class="va">exposureTypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"inf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the exposure_data dataframe</span></span>
<span><span class="va">exposure_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span><span class="op">)</span>,</span>
<span>  exposure_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"inf"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">exposureFitted</span> <span class="op">&lt;-</span> <span class="st">"inf"</span></span>
<span></span>
<span><span class="co"># Create the attack_rate_data dataframe</span></span>
<span><span class="va">attack_rate_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">)</span>,</span>
<span>  prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">25</span>, <span class="fl">25</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">modeldefinition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    biomarkers <span class="op">=</span> <span class="va">biomarkers</span>,</span>
<span>    exposureTypes <span class="op">=</span> <span class="va">exposureTypes</span>,</span>
<span>    exposureFitted <span class="op">=</span> <span class="va">exposureFitted</span>,</span>
<span>    observationalModel <span class="op">=</span> <span class="va">observationalModel</span>,</span>
<span>    abkineticsModel <span class="op">=</span> <span class="va">abkineticsModel</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">seroModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSeroJumpModel.html">createSeroJumpModel</a></span><span class="op">(</span><span class="va">data_sero</span>, <span class="cn">NULL</span>, <span class="va">modeldefinition</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## OUTLINE OF INPUTTED MODEL</span></span>
<span><span class="co">## There are  1  measured biomarkers:  IgG </span></span>
<span><span class="co">## There are  2  exposure types in the study period:  none, inf </span></span>
<span><span class="co">## The fitted exposure type is  inf </span></span>
<span><span class="co">## PRIOR DISTRIBUTIONS </span></span>
<span><span class="co">## Prior parameters of observationalModel are:  sigma </span></span>
<span><span class="co">## Prior parameters of abkineticsModel are:  y1_h1, t1_h1, r_h1, s, wane </span></span>
<span><span class="co">## Exposure rate is not defined over the time period. Defaulting to uniform distribution between 1 and  50 .</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="pre-run-sanity-plots">4.Pre run sanity plots<a class="anchor" aria-label="anchor" href="#pre-run-sanity-plots"></a>
</h2>
<p>Before running the whoel model it is good to check the data and the
priors. This can be done using a suit of functions
<code>plotPriors</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotSero.html">plotSero</a></span><span class="op">(</span><span class="va">seroModel</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotPriorPredictive.html">plotPriorPredictive</a></span><span class="op">(</span><span class="va">seroModel</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotPriorInfection.html">plotPriorInfection</a></span><span class="op">(</span><span class="va">seroModel</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span></code></pre></div>
<p><img src="model_define_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p3</span></span></code></pre></div>
<p><img src="model_define_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="run-the-model">4. Run the model!<a class="anchor" aria-label="anchor" href="#run-the-model"></a>
</h2>
<p>Once seroModel is defined, the user can run the model using the
<code>runSeroJump</code> function. This function requires the seroModel,
settings for the RJ-MCMC algorithm, and information about saving the
model outputs.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">save_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    file_name <span class="op">=</span> <span class="st">"simple"</span>,</span>
<span>    model_name <span class="op">=</span> <span class="st">"ex1"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using more than one core might fail on windows, </span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"windows"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mc.cores</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">mc.cores</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># use as many as available, preferably 4.</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rj_settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        numberChainRuns <span class="op">=</span> <span class="fl">4</span>, </span>
<span>        numberCores <span class="op">=</span> <span class="va">mc.cores</span>,</span>
<span>        iterations <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>        burninPosterior <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>        thin <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSeroJump.html">runSeroJump</a></span><span class="op">(</span><span class="va">seroModel</span>, <span class="va">rj_settings</span>, save_info <span class="op">=</span> <span class="va">save_info</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-the-outputs">5. Plot the outputs<a class="anchor" aria-label="anchor" href="#plot-the-outputs"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Need to have save_info model_summary to run these</span></span>
<span><span class="fu"><a href="../reference/plotMCMCDiagnosis.html">plotMCMCDiagnosis</a></span><span class="op">(</span><span class="va">model_summary</span>, save_info <span class="op">=</span> <span class="va">save_info</span><span class="op">)</span> <span class="co"># plots the convergence diagnosis</span></span>
<span><span class="fu"><a href="../reference/plotPostFigs.html">plotPostFigs</a></span><span class="op">(</span><span class="va">model_summary</span>, save_info <span class="op">=</span> <span class="va">save_info</span><span class="op">)</span> <span class="co">#plots some plots of the posteriors</span></span></code></pre></div>
<p><code>model_summary$post</code> has all the posterior distributions
which the user can extract and plot themselves!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Hodgson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
